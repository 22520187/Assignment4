<div class="p-6">
    <!--Header: Search + Filter + Create Brand-->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-6">
        <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
            <input type="text" placeholder="Search brands..." [(ngModel)]="searchQuery" (ngModelChange)="onSearch()"
                class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-64" />
            <select [(ngModel)]="categoryFilter" (ngModelChange)="onSearch()"
                class="ml-0 sm:ml-3 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-48">
                <option value="">All Categories</option>
                <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
            </select>
        </div>
        <button (click)="openCreate()"
            class="mt-4 sm:mt-0 inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-700 transition">
            <i class="fas fa-plus mr-2"></i> Add New Brand
        </button>
    </div>

    <!-- Brand Cards Grid -->
    <div *ngIf="!isLoading && filteredBrands.length > 0" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
        <div *ngFor="let brand of filteredBrands" class="rounded-xl shadow-md bg-white p-6 flex flex-col relative border border-gray-100">
            <div class="flex items-center justify-center w-14 h-14 mb-4 rounded-xl bg-gradient-to-tr from-blue-400 to-purple-500">
                <img *ngIf="brand.image" [src]="brand.image" alt="Brand logo" class="object-contain w-12 h-12 rounded shadow border bg-white" />
                <span *ngIf="!brand.image" class="text-2xl font-bold text-white">{{ brand.name.charAt(0) }}</span>
            </div>
            <div class="font-semibold text-lg mb-1">{{ brand.name }}</div>
            <div class="text-xs text-gray-500 mb-2">{{ brand.category }}</div>
            <div class="text-gray-600 text-sm flex-grow mb-2">{{ brand.description }}</div>
            <div class="mt-auto flex justify-between items-center">
                <span class="px-3 py-1 rounded-full text-xs font-medium"
                    [class.bg-green-100]="brand.status === 'active'"
                    [class.text-green-800]="brand.status === 'active'"
                    [class.bg-yellow-100]="brand.status === 'pending'"
                    [class.text-yellow-800]="brand.status === 'pending'"
                    [class.bg-gray-100]="brand.status === 'inactive'"
                    [class.text-gray-800]="brand.status === 'inactive'">
                    {{ brand.status === 'active' ? 'Active' : (brand.status === 'pending' ? 'Pending' : 'Inactive') }}
                </span>
                <span class="text-xs text-gray-400">{{ brand.productCount }} Products</span>
            </div>
            <div class="absolute top-4 right-4 flex gap-2">
                <button (click)="openEdit(brand)" title="Edit"
                    class="p-2 text-blue-500 hover:bg-blue-50 rounded-full border border-transparent hover:border-blue-200">
                    <i class="fas fa-edit"></i>
                </button>
                <button (click)="deleteBrand(brand)" title="Delete"
                    class="p-2 text-red-500 hover:bg-red-50 rounded-full border border-transparent hover:border-red-200">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && filteredBrands.length === 0" class="py-16 text-center text-gray-500">
        <i class="fas fa-box-open text-4xl mb-4"></i>
        <p class="text-lg">No brands found</p>
        <p class="text-sm">Add a new brand to get started</p>
    </div>

    <!-- Modal Form for Add/Edit Brand -->
    <div *ngIf="showForm" class="fixed inset-0 z-40 flex items-center justify-center">
        <div class="absolute inset-0 bg-black/30" (click)="closeForm()"></div>
        <div class="relative z-50 w-full max-w-lg bg-white rounded-xl shadow-lg p-6">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-bold text-gray-800">
                    {{ formMode === 'create' ? 'Add Brand' : 'Edit Brand' }}
                </h2>
                <button (click)="closeForm()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4">
                <!-- IMAGE FIELD -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Brand Logo/Image</label>
                    <div class="flex gap-3 items-center">
                        <img *ngIf="currentBrand.image" [src]="currentBrand.image" class="w-16 h-16 object-contain rounded bg-gray-100 border" alt="Preview" />
                        <button *ngIf="currentBrand.image" (click)="removeImage()" type="button" class="text-xs text-red-600 hover:underline">Remove</button>
                        <input type="file" accept="image/*" (change)="handleImageChange($event)" class="block" />
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Brand Name <span class="text-red-500">*</span></label>
                    <input type="text" [(ngModel)]="currentBrand.name" placeholder="Enter brand name"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Category <span class="text-red-500">*</span></label>
                    <select [(ngModel)]="currentBrand.category" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="">Select category...</option>
                        <option *ngFor="let cat of categories" [value]="cat">{{ cat }}</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                    <textarea [(ngModel)]="currentBrand.description" placeholder="Enter description"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Status <span class="text-red-500">*</span></label>
                    <select [(ngModel)]="currentBrand.status"
                        class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <option value="active">Active</option>
                        <option value="pending">Pending</option>
                        <option value="inactive">Inactive</option>
                    </select>
                </div>
                <div *ngIf="formError" class="text-red-500 text-sm">
                    <i class="fas fa-exclamation-circle mr-1"></i> {{ formError }}
                </div>
            </div>
            <div class="mt-6 flex items-center justify-end gap-2">
                <button (click)="closeForm()"
                    class="px-4 py-2 text-gray-500 bg-gray-200 rounded-lg hover:bg-gray-300 transition">
                    <i class="fas fa-times mr-1"></i> Cancel
                </button>
                <button (click)="saveBrand()"
                    class="px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-700 transition">
                    <i class="fas fa-save mr-1"></i> {{ formMode === 'create' ? 'Add' : 'Save Changes' }}
                </button>
            </div>
        </div>
    </div>
</div>
